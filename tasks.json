{
  "version": "1.0",
  "blueprint_source": "./WEAVER_BLUEPRINT.md",
  "generated_at": "2026-02-06T19:30:00Z",
  "thread_id": "merge-workflow-enhancements-v1.7.0",

  "metadata": {
    "total_tasks": 18,
    "estimated_agent_loops": 18,
    "critical_path": ["T1", "T2", "T3", "T8", "T11"],
    "parallelizable_groups": [
      ["T4", "T5"],
      ["T7"],
      ["T8", "T9", "T10"],
      ["T12", "T13", "T14"],
      ["T15", "T16"],
      ["T17", "T18"]
    ]
  },

  "tasks": [
    {
      "id": "T1",
      "name": "Refactor hierarchy-detector.sh",
      "type": "implementation",
      "description": "Create hierarchy-detector.sh from workflow-enhancements with path-config integration. Replace 30+ hardcoded paths with dynamic resolution.",
      "priority": 1,
      "atomicity": {
        "file_count": 1,
        "estimated_lines": 541,
        "concerns": ["path-refactoring"],
        "within_limits": false
      },
      "target_files": [
        {
          "path": "scripts/hierarchy-detector.sh",
          "action": "CREATE",
          "purpose": "Hierarchical organization detection with dynamic paths"
        }
      ],
      "constraints": [
        {
          "rule": "Source path-config.sh at top",
          "source": "C3",
          "example": "source path-config.sh; load_path_config"
        },
        {
          "rule": "Replace .claude with get_claude_dir_name()",
          "source": "C2",
          "example": "claude_dir_name=$(get_claude_dir_name)"
        }
      ],
      "validation": {
        "command": "bash -n scripts/hierarchy-detector.sh && shellcheck scripts/hierarchy-detector.sh",
        "expected_outcome": "Syntax valid, shellcheck passes",
        "timeout_seconds": 60
      },
      "dependencies": {
        "depends_on": [],
        "blocks": ["T2", "T3", "T4", "T7"]
      }
    },
    {
      "id": "T2",
      "name": "Integrate role-manager.sh",
      "type": "implementation",
      "description": "Add cmd_add_role_guides() from workflow-enhancements, refactor for path-config.",
      "priority": 2,
      "atomicity": {
        "file_count": 1,
        "estimated_lines": 150,
        "concerns": ["function-integration"],
        "within_limits": true
      },
      "target_files": [
        {
          "path": "scripts/role-manager.sh",
          "action": "MODIFY",
          "purpose": "Add selective role guide initialization"
        }
      ],
      "validation": {
        "command": "bash -n scripts/role-manager.sh && shellcheck scripts/role-manager.sh",
        "expected_outcome": "Syntax valid, shellcheck passes",
        "timeout_seconds": 60
      },
      "dependencies": {
        "depends_on": ["T1"],
        "blocks": ["T6"]
      }
    },
    {
      "id": "T3",
      "name": "Integrate level-detector.sh",
      "type": "implementation",
      "description": "Add hierarchy-detector sourcing, integrate hierarchy-aware prompts.",
      "priority": 3,
      "atomicity": {
        "file_count": 1,
        "estimated_lines": 100,
        "concerns": ["hierarchy-integration"],
        "within_limits": true
      },
      "target_files": [
        {
          "path": "scripts/level-detector.sh",
          "action": "MODIFY",
          "purpose": "Add hierarchy-aware level detection"
        }
      ],
      "validation": {
        "command": "bash -n scripts/level-detector.sh && shellcheck scripts/level-detector.sh",
        "expected_outcome": "Syntax valid, shellcheck passes",
        "timeout_seconds": 60
      },
      "dependencies": {
        "depends_on": ["T1"],
        "blocks": []
      }
    },
    {
      "id": "T4",
      "name": "Integrate template-manager.sh",
      "type": "implementation",
      "description": "Source hierarchy-detector, remove moved functions.",
      "priority": 4,
      "atomicity": {
        "file_count": 1,
        "estimated_lines": 50,
        "concerns": ["function-removal"],
        "within_limits": true
      },
      "target_files": [
        {
          "path": "scripts/template-manager.sh",
          "action": "MODIFY",
          "purpose": "Integrate hierarchy-detector"
        }
      ],
      "validation": {
        "command": "bash -n scripts/template-manager.sh && shellcheck scripts/template-manager.sh",
        "expected_outcome": "Syntax valid, shellcheck passes",
        "timeout_seconds": 60
      },
      "dependencies": {
        "depends_on": ["T1"],
        "blocks": []
      }
    },
    {
      "id": "T5",
      "name": "Integrate post-install.sh",
      "type": "implementation",
      "description": "Merge enhanced messaging from workflow-enhancements.",
      "priority": 5,
      "atomicity": {
        "file_count": 1,
        "estimated_lines": 30,
        "concerns": ["messaging"],
        "within_limits": true
      },
      "target_files": [
        {
          "path": "scripts/post-install.sh",
          "action": "MODIFY",
          "purpose": "Improve messaging"
        }
      ],
      "validation": {
        "command": "bash -n scripts/post-install.sh && shellcheck scripts/post-install.sh",
        "expected_outcome": "Syntax valid, shellcheck passes",
        "timeout_seconds": 60
      },
      "dependencies": {
        "depends_on": [],
        "blocks": []
      }
    },
    {
      "id": "T6",
      "name": "Add add-role-guides command",
      "type": "implementation",
      "description": "Copy add-role-guides files from workflow-enhancements.",
      "priority": 6,
      "atomicity": {
        "file_count": 2,
        "estimated_lines": 450,
        "concerns": ["command-creation"],
        "within_limits": false
      },
      "target_files": [
        {
          "path": "commands/add-role-guides.sh",
          "action": "CREATE",
          "purpose": "Command script"
        },
        {
          "path": "commands/add-role-guides.md",
          "action": "CREATE",
          "purpose": "Documentation"
        }
      ],
      "validation": {
        "command": "bash -n commands/add-role-guides.sh && shellcheck commands/add-role-guides.sh",
        "expected_outcome": "Syntax valid, shellcheck passes",
        "timeout_seconds": 60
      },
      "dependencies": {
        "depends_on": ["T2"],
        "blocks": ["T9"]
      }
    },
    {
      "id": "T7",
      "name": "Update hierarchy tests",
      "type": "test",
      "description": "Add custom path scenarios to existing hierarchy tests.",
      "priority": 7,
      "atomicity": {
        "file_count": 3,
        "estimated_lines": 200,
        "concerns": ["test-updates"],
        "within_limits": true
      },
      "target_files": [
        {
          "path": "tests/test-hierarchy-detector.sh",
          "action": "MODIFY",
          "purpose": "Add custom path tests"
        },
        {
          "path": "tests/test-hierarchical-initialization.sh",
          "action": "MODIFY",
          "purpose": "Add path-config tests"
        },
        {
          "path": "tests/test-role-guide-selection.sh",
          "action": "MODIFY",
          "purpose": "Add custom path tests"
        }
      ],
      "validation": {
        "command": "./tests/test-hierarchy-detector.sh && ./tests/test-hierarchical-initialization.sh && ./tests/test-role-guide-selection.sh",
        "expected_outcome": "All tests pass",
        "timeout_seconds": 300
      },
      "dependencies": {
        "depends_on": ["T1"],
        "blocks": []
      }
    },
    {
      "id": "T8",
      "name": "Test hierarchy with custom paths",
      "type": "test",
      "description": "Create integration test for hierarchy + custom paths.",
      "priority": 8,
      "atomicity": {
        "file_count": 1,
        "estimated_lines": 400,
        "concerns": ["integration-testing"],
        "within_limits": false
      },
      "target_files": [
        {
          "path": "tests/test-hierarchy-with-custom-paths.sh",
          "action": "CREATE",
          "purpose": "Integration tests"
        }
      ],
      "validation": {
        "command": "./tests/test-hierarchy-with-custom-paths.sh",
        "expected_outcome": "All tests pass",
        "timeout_seconds": 300
      },
      "dependencies": {
        "depends_on": ["T1", "T7"],
        "blocks": []
      }
    },
    {
      "id": "T9",
      "name": "Test add-role-guides with custom paths",
      "type": "test",
      "description": "Create integration test for add-role-guides command.",
      "priority": 9,
      "atomicity": {
        "file_count": 1,
        "estimated_lines": 300,
        "concerns": ["integration-testing"],
        "within_limits": true
      },
      "target_files": [
        {
          "path": "tests/test-add-role-guides-custom-paths.sh",
          "action": "CREATE",
          "purpose": "Command integration tests"
        }
      ],
      "validation": {
        "command": "./tests/test-add-role-guides-custom-paths.sh",
        "expected_outcome": "All tests pass",
        "timeout_seconds": 180
      },
      "dependencies": {
        "depends_on": ["T6"],
        "blocks": []
      }
    },
    {
      "id": "T10",
      "name": "Test combined validation",
      "type": "test",
      "description": "Create test for combined path+hierarchy validation.",
      "priority": 10,
      "atomicity": {
        "file_count": 1,
        "estimated_lines": 200,
        "concerns": ["validation-testing"],
        "within_limits": true
      },
      "target_files": [
        {
          "path": "tests/test-combined-validation.sh",
          "action": "CREATE",
          "purpose": "Validation tests"
        }
      ],
      "validation": {
        "command": "./tests/test-combined-validation.sh",
        "expected_outcome": "All tests pass",
        "timeout_seconds": 180
      },
      "dependencies": {
        "depends_on": ["T1"],
        "blocks": []
      }
    },
    {
      "id": "T11",
      "name": "Test hierarchy performance",
      "type": "test",
      "description": "Create performance benchmark suite.",
      "priority": 11,
      "atomicity": {
        "file_count": 1,
        "estimated_lines": 300,
        "concerns": ["performance-testing"],
        "within_limits": true
      },
      "target_files": [
        {
          "path": "tests/test-hierarchy-performance.sh",
          "action": "CREATE",
          "purpose": "Performance benchmarks"
        }
      ],
      "validation": {
        "command": "./tests/test-hierarchy-performance.sh",
        "expected_outcome": "All benchmarks pass",
        "timeout_seconds": 300
      },
      "dependencies": {
        "depends_on": ["T1", "T8"],
        "blocks": []
      }
    },
    {
      "id": "T12",
      "name": "Merge CHEATSHEET.md",
      "type": "documentation",
      "description": "Combine command documentation from both branches.",
      "priority": 12,
      "atomicity": {
        "file_count": 1,
        "estimated_lines": 150,
        "concerns": ["documentation"],
        "within_limits": true
      },
      "target_files": [
        {
          "path": "CHEATSHEET.md",
          "action": "MODIFY",
          "purpose": "Merge documentation"
        }
      ],
      "validation": {
        "command": "grep -q 'configure-paths' CHEATSHEET.md && grep -q 'add-role-guides' CHEATSHEET.md",
        "expected_outcome": "Both features documented",
        "timeout_seconds": 10
      },
      "dependencies": {
        "depends_on": [],
        "blocks": []
      }
    },
    {
      "id": "T13",
      "name": "Merge CLAUDE.md",
      "type": "documentation",
      "description": "Integrate architecture documentation.",
      "priority": 13,
      "atomicity": {
        "file_count": 1,
        "estimated_lines": 200,
        "concerns": ["documentation"],
        "within_limits": true
      },
      "target_files": [
        {
          "path": "CLAUDE.md",
          "action": "MODIFY",
          "purpose": "Merge architecture docs"
        }
      ],
      "validation": {
        "command": "grep -q 'path-config' CLAUDE.md && grep -q 'hierarchy' CLAUDE.md",
        "expected_outcome": "Both architectures documented",
        "timeout_seconds": 10
      },
      "dependencies": {
        "depends_on": [],
        "blocks": []
      }
    },
    {
      "id": "T14",
      "name": "Update command docs",
      "type": "documentation",
      "description": "Update command documentation files.",
      "priority": 14,
      "atomicity": {
        "file_count": 2,
        "estimated_lines": 300,
        "concerns": ["documentation"],
        "within_limits": true
      },
      "target_files": [
        {
          "path": "commands/init-org-template.md",
          "action": "MODIFY",
          "purpose": "Add combined docs"
        },
        {
          "path": "commands/validate-setup.md",
          "action": "MODIFY",
          "purpose": "Add validation docs"
        }
      ],
      "validation": {
        "command": "grep -q 'custom paths' commands/init-org-template.md",
        "expected_outcome": "Documentation present",
        "timeout_seconds": 10
      },
      "dependencies": {
        "depends_on": [],
        "blocks": []
      }
    },
    {
      "id": "T15",
      "name": "Create HIERARCHICAL-ORGANIZATIONS.md",
      "type": "documentation",
      "description": "Create comprehensive hierarchical organization guide.",
      "priority": 15,
      "atomicity": {
        "file_count": 1,
        "estimated_lines": 800,
        "concerns": ["documentation"],
        "within_limits": false
      },
      "target_files": [
        {
          "path": "docs/HIERARCHICAL-ORGANIZATIONS.md",
          "action": "CREATE",
          "purpose": "Hierarchy guide"
        }
      ],
      "validation": {
        "command": "test -f docs/HIERARCHICAL-ORGANIZATIONS.md",
        "expected_outcome": "Guide exists",
        "timeout_seconds": 10
      },
      "dependencies": {
        "depends_on": [],
        "blocks": []
      }
    },
    {
      "id": "T16",
      "name": "Create COMBINED-FEATURES.md",
      "type": "documentation",
      "description": "Create integration guide for combined features.",
      "priority": 16,
      "atomicity": {
        "file_count": 1,
        "estimated_lines": 600,
        "concerns": ["documentation"],
        "within_limits": false
      },
      "target_files": [
        {
          "path": "docs/COMBINED-FEATURES.md",
          "action": "CREATE",
          "purpose": "Integration guide"
        }
      ],
      "validation": {
        "command": "test -f docs/COMBINED-FEATURES.md",
        "expected_outcome": "Guide exists",
        "timeout_seconds": 10
      },
      "dependencies": {
        "depends_on": [],
        "blocks": []
      }
    },
    {
      "id": "T17",
      "name": "Update README.md",
      "type": "documentation",
      "description": "Update README for v1.7.0 release.",
      "priority": 17,
      "atomicity": {
        "file_count": 1,
        "estimated_lines": 100,
        "concerns": ["documentation"],
        "within_limits": true
      },
      "target_files": [
        {
          "path": "README.md",
          "action": "MODIFY",
          "purpose": "v1.7.0 updates"
        }
      ],
      "validation": {
        "command": "grep -q 'v1.7.0' README.md",
        "expected_outcome": "Version documented",
        "timeout_seconds": 10
      },
      "dependencies": {
        "depends_on": [],
        "blocks": []
      }
    },
    {
      "id": "T18",
      "name": "Update CHANGELOG.md",
      "type": "documentation",
      "description": "Add v1.7.0 changelog entry.",
      "priority": 18,
      "atomicity": {
        "file_count": 1,
        "estimated_lines": 100,
        "concerns": ["documentation"],
        "within_limits": true
      },
      "target_files": [
        {
          "path": "CHANGELOG.md",
          "action": "MODIFY",
          "purpose": "Changelog update"
        }
      ],
      "validation": {
        "command": "grep -q 'v1.7.0' CHANGELOG.md",
        "expected_outcome": "Changelog updated",
        "timeout_seconds": 10
      },
      "dependencies": {
        "depends_on": [],
        "blocks": []
      }
    }
  ],

  "execution_plan": {
    "phases": [
      {
        "phase": 1,
        "name": "Core Refactoring",
        "tasks": ["T1"],
        "parallel": false
      },
      {
        "phase": 2,
        "name": "Script Integration",
        "tasks": ["T2", "T3"],
        "parallel": false
      },
      {
        "phase": 3,
        "name": "Secondary Integration",
        "tasks": ["T4", "T5"],
        "parallel": true
      },
      {
        "phase": 4,
        "name": "Command Addition",
        "tasks": ["T6"],
        "parallel": false
      },
      {
        "phase": 5,
        "name": "Test Updates",
        "tasks": ["T7"],
        "parallel": false
      },
      {
        "phase": 6,
        "name": "Integration Testing",
        "tasks": ["T8", "T9", "T10"],
        "parallel": true
      },
      {
        "phase": 7,
        "name": "Performance Testing",
        "tasks": ["T11"],
        "parallel": false
      },
      {
        "phase": 8,
        "name": "Documentation - Commands",
        "tasks": ["T12", "T13", "T14"],
        "parallel": true
      },
      {
        "phase": 9,
        "name": "Documentation - Guides",
        "tasks": ["T15", "T16"],
        "parallel": true
      },
      {
        "phase": 10,
        "name": "Documentation - Release",
        "tasks": ["T17", "T18"],
        "parallel": true
      }
    ],
    "estimated_total_loops": 18
  }
}
